<?xml version="1.0" encoding="UTF-8"?>
<ui:composition template="../WEB-INF/template.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui">
    <ui:define name="content">
        <p:panel>
            <f:facet name="header">
                <div class="ui-fluid">
                    <div class="ui-g">
                        <div class="ui-g-12 ui-ml-12 ui-lg-12 Padding0">
                            <div class="ui-g-12 ui-ml-7 ui-lg-8 Padding0">
                                <h:outputText value="Notas de Versión" />
                            </div>
                        </div> 
                    </div>
                </div>
            </f:facet>

            <h:form id="NotasVersionForm">
                <p:growl id="versionGrowl" showDetail="true" showSummary="true" life="6000" />
                <p:dataTable id="tablaVersiones"
                             value="#{versionRigelJSF.listaVersiones}"
                             var="item"   
                             selectionMode="single" 
                             selection="#{versionRigelJSF.selected}"
                             rowKey="#{item.idVersionRigel}"  
                             rowSelectMode="add"
                             paginator="true"
                             rows="15"
                             style="width:100%"  
                             scrollable="true"
                             rowsPerPageTemplate="15,30,50">     

                    <p:ajax event="rowSelect" listener="#{versionRigelJSF.onRowSelect}" update="editButton" />
                    <p:ajax event="rowUnselect" listener="#{versionRigelJSF.onUnRowSelect}" update="editButton" />


                    <p:column headerText="Fecha" style="text-align: center; width: 100px; white-space: nowrap">
                        <h:outputText value="#{item.fecha}">                            
                            <f:convertDateTime pattern="yyyy-MM-dd"/>
                        </h:outputText>                        
                    </p:column>
                    <p:column headerText="Versión" style="text-align: center; width: 100px; white-space: nowrap">
                        <h:outputText value="#{item.version}" />                        
                    </p:column>
                    <p:column headerText="Tipo de versión" style="text-align: center; width: 120px; white-space: nowrap">
                        <h:outputText value="#{item.idVersionTipo.nombreVersionTipo}" />
                    </p:column>
                    <p:column headerText="Detalle"
                              exportFunction="#{versionRigelJSF.obtenerTextoExportar(item.observaciones)}">  
                        <p:outputPanel layout="block" style="pointer-events: none">
                            <h:outputText value="#{versionRigelJSF.convertirDescripcionHTML(item.observaciones)}" escape="false" 
                                          style="word-wrap: break-word; overflow-wrap: break-word; white-space: normal;
                                          pointer-events: none"/>                            
                        </p:outputPanel>                        
                    </p:column>                    
                    <p:column headerText="Usuario" style="text-align: center; width: 150px; white-space: nowrap">
                        <h:outputText value="#{item.usernameCreate}" />
                    </p:column>                   
                    <f:facet name="header">
                        <div align="right">
                            <p:commandButton id="createButton"   
                                             value="Nuevo"                                              
                                             update="VersionCreateForm"                                              
                                             icon="fa fa-plus" 
                                             class="cssWhite"
                                             oncomplete="PF('VersionCreateDialog').show()">
                                <p:resetInput target=":VersionCreateForm" />                                      
                            </p:commandButton>                            
                            <p:commandButton id="editButton" 
                                             value="Editar" 
                                             icon="fa fa-pencil" 
                                             action="#{versionRigelJSF.prepareEdit()}"
                                             update=":VersionEditForm"
                                             disabled="#{empty versionRigelJSF.selected.idVersionRigel}"
                                             class="cssWhite GreenButton" 
                                             oncomplete="PF('VersionEditDialog').show()">
                                <p:resetInput target=":VersionEditForm" />
                            </p:commandButton>    
                        </div>
                    </f:facet>
                    <f:facet name="footer">
                        <div style="float: right; padding-bottom: 5px;">
                            <h:commandLink>
                                <img src="../../resources/img/excel.png" 
                                     title="Exportar en formato Excel"
                                     alt="excel" 
                                     style="width: 24px; height: 24px;" />
                                <p:dataExporter type="xlsx" target="tablaVersiones" 
                                                fileName="NotasDeVersionRigel" />
                            </h:commandLink>
                            <h:commandLink>
                                <img src="../../resources/img/pdf.png" title="Exportar en formato pdf"
                                     alt="pdf" style="width: 24px;height: 24px"/>
                                <p:dataExporter type="pdf" target="tablaVersiones" fileName="NotasDeVersionRigel" />
                            </h:commandLink>
                        </div>
                    </f:facet>
                </p:dataTable>
            </h:form>
        </p:panel>
        <ui:include src="./modals/Create.xhtml"/>
        <ui:include src="./modals/Edit.xhtml"/>
    </ui:define>
</ui:composition>
